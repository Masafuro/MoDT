# MoDT Monitor ユニット利用ガイド

このディレクトリは、MoDTシステム内のすべてのMQTT通信を傍受し、人間が読みやすい形式でリアルタイムに表示するモニターユニットを管理します。開発中のデバッグや、ユニット間でのメッセージのやり取りを確認するための中心的なツールとして機能します。

## 前提条件

このユニットを動作させるためには、事前に共通基盤であるブローカーが起動している必要があります。brokerディレクトリに移動し、共通ネットワーク（modt-network）とブローカーコンテナが立ち上がっていることを確認してください。

## 起動とログの確認方法

モニターを開始するには、このディレクトリで以下のコマンドを実行してください。
> docker-compose up -d

コンテナが起動した後、リアルタイムで流れる通信ログを監視するには、以下のコマンドでログ出力を表示させます。
> docker logs -f modt-monitor

この状態でシステム内を流れるメッセージがターミナルに整形されて表示されます。終了する場合は Ctrl + C でログ出力を抜け、コンテナを停止させる際は以下のコマンドを実行してください。
> docker-compose down

## 動作テストの方法（Windows PowerShell）

ブローカーを経由してテスト用のメッセージを送信し、モニターが正しく受信・整形できるかを確認するには、以下のコマンドを利用します。WindowsのPowerShellを利用する場合、JSON内のダブルクォーテーションを適切に認識させるために、バッククォートを用いたエスケープ処理が必要です。
> docker exec -it modt-broker mosquitto_pub -t "modt/state/set" -m "{\`"user_id\`": \`"user001\`", \`"key\`": \`"theme\`", \`"value\`": \`"dark\`", \`"timestamp\`": \`"2025-12-31T16:00:00\`"}"

このコマンドを実行した際、モニター側のログに送信したJSONデータが境界線とともに整形して表示されれば、システム全体の通信経路が正常に確立されています。
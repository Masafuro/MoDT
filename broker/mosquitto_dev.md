# MoDT 通信基盤（Broker）開発仕様書

## 1. 概要
MoDTフレームワークにおけるメッセージングのハブとして機能するMQTTブローカー（Mosquitto）の仕様を定義します。本コンポーネントはシステム全体の神経系を担い、各モジュール間の疎結合な連携を実現します。

---

## 2. コンテナ構成
ブローカーはDockerコンテナとして独立しており、以下のパラメータで管理されます。

| 項目 | 設定値 | 役割・備考 |
| :--- | :--- | :--- |
| コンテナ名 | `modt-broker` | システム全体のメッセージハブ。 |
| 使用イメージ | `eclipse-mosquitto:latest` | 公式の安定版イメージを採用。 |
| 所属ネットワーク | `modt-network` | 外部から隔離されたモジュール間専用の通信路。 |
| 内部ポート | `1883` | MQTT標準ポート。ホスト側へのポート開放は行わない。 |

---

## 3. ストレージと設定の配置
ホストマシンのディレクトリとコンテナ内のパスをマウントすることで、設定の柔軟性とデータの永続性を確保しています。

| ホスト側パス | コンテナ側パス | 用途 |
| :--- | :--- | :--- |
| `./broker/mosquitto.conf` | `/mosquitto/config/mosquitto.conf` | 動作定義ファイル（匿名接続許可等）。 |
| `./broker/data/` | `/mosquitto/data/` | メッセージおよびセッションの永続化。 |
| `./broker/log/` | `/mosquitto/log/` | 通信ログおよびエラーログの出力。 |

---

## 4. セキュリティ方針
- **ネットワーク分離**: Dockerの仮想ネットワーク機能を活用し、VPSの外部およびホストOSからの直接接続を遮断しています。
- **アクセス制御**: 開発初期は利便性を優先して匿名接続を許可していますが、通信経路自体を閉鎖することで安全性を担保しています。
- **ログ管理**: すべての接続とメッセージの流量をログとして記録し、監視ユニットによる異常検知の基礎データとします。
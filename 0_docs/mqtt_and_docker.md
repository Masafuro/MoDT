MoDTの通信基盤が正しく構築されているかを確認するための手順をまとめました。これらのコマンドは、開発方針である「内部ネットワークの閉鎖性」を維持したまま、コンテナの内部から動作を検証するためのものです。

### システムの起動と状態確認

まず最初に、プロジェクトのルートディレクトリで以下のコマンドを実行して、Mosquittoブローカーを起動します。`-d`オプションを付けることでコンテナがバックグラウンドで実行され、ターミナルを占有せずに動作を継続できます。

```bash
# コンテナの起動
docker-compose up -d

# 起動状態の確認
docker-compose ps

```

コンテナが正常に起動していることを確認したら、次にブローカーのログを表示して、設定ファイルが正しく読み込まれているか、リスナーが開始されているかをチェックします。以下のコマンドで、最新のログ出力を確認できます。

```bash
# ブローカーの動作ログ確認
docker-compose logs -f broker

```

---

### MQTTの疎通確認（Pub/Subテスト）

ブローカーが正常に動作していることが確認できたら、実際にメッセージの送受信テストを行います。MoDTでは外部にポートを開かない運用を想定しているため、`docker exec`コマンドを使用してコンテナの内部に入り、同梱されているクライアントツールを利用します。

まず、メッセージを待ち受ける「購読者（Subscriber）」を起動します。このコマンドを実行すると、ターミナルはメッセージの待機状態になります。

```bash
# メッセージの待機（別ターミナルで実行を推奨）
docker exec -it modt-broker mosquitto_sub -t "modt/test"

```

次に、別のターミナルウィンドウを開き、以下のコマンドでテストメッセージを送信（Publish）します。送信した瞬間に、先ほどの待機画面に「Hello MoDT」という文字列が表示されれば、ブローカーを介した疎結合な通信が成功している証拠です。

```bash
# テストメッセージの送信
docker exec -it modt-broker mosquitto_pub -t "modt/test" -m "Hello MoDT"

```

---

### 検証の終了

一連のテストが完了し、システムの動作に問題がないことが確認できたら、以下のコマンドでコンテナを停止します。ボリューム設定を正しく行っていれば、次回の起動時もこれまでのデータや設定を引き継ぐことが可能です。

```bash
# システムの停止
docker-compose down

```

以上の手順で、MoDTの最小構成である通信ハブの検証が完了します。この手順をリポジトリの `TESTING.md` などに保存しておくと、将来新しいモジュールを追加した際のトラブルシューティングにおいて、ネットワークに問題があるのか、あるいはアプリのロジックに問題があるのかを切り分けるための基準として役立ちます。

この基本インフラの動作確認が取れた後は、いよいよPythonによる「最初のブロック」の実装に入ることができます。次は、このブローカーに接続してログインイベントを待ち受ける、Auth Unit用のPythonテンプレートコードを作成してみましょうか。
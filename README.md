# MoDT
MQTTを基盤とした、Dockerコンテナによるポン付け可能な疎結合アプリケーションフレームワーク

## 開発進捗
- 令和7年12月30日
  - dummy-app-unitの動作確認まで行った。
  - 次はログインユニットの構築
  - 

## プロトコル
```md

# MoDT プロトコル仕様書 (Version 1.0)

## 1. 認証成功イベント (Authentication Success)

このメッセージは、認証ユニット（auth-unit）がユーザーの正当性を確認した直後に、システム全体へ向けて発行される最初の号砲です。

**トピック名：** `modt/auth/success`

**発行タイミング：**
ユーザーがログイン画面で正しいIDとパスワードを入力し、データベースによる照合が完了した瞬間に発行されます。

**データ形式（JSON）：**
ペイロードにはユーザーを識別するための「user_id」、権限を管理する「role」、ブラウザ側のセッションを維持するための「session_id」、そしてイベントの発生時刻を示す「timestamp」が含まれます。具体的には以下の構造となります。

{
  "user_id": "ユーザーを識別するユニークな文字列",
  "role": "権限情報（admin、userなど）",
  "session_id": "セッション管理用の固有トークン",
  "timestamp": "ISO8601形式の時刻情報"
}

---

## 2. アプリケーション準備完了イベント (Application Ready)

このメッセージは、認証成功の信号を受け取った各アプリケーションユニット（今回の例では dummy-app-unit）が、ユーザーを迎え入れる準備が整ったことを宣言する応答です。

**トピック名：** `modt/app/ready`

**発行タイミング：**
各アプリユニットが `modt/auth/success` トピックを購読し、自分に関係のあるユーザー情報を受け取った直後に、自律的に発行します。

**データ形式（JSON）：**
ペイロードには、応答したアプリケーションの名前である「app_name」、ブラウザが遷移すべき具体的な場所を示す「redirect_url」、そしてどのユーザーに対する応答かを明示する「user_id」が含まれます。具体的には以下の構造となります。

{
  "app_name": "アプリケーションの識別名",
  "redirect_url": "ユーザーがアクセスすべきWEBサーバーのURL",
  "user_id": "対象となるユーザーのID"
}

---

## 3. 監視とログ記録 (Monitoring and Logging)

モニターユニット（monitor）は、上記のすべてのトピックをワイルドカード `modt/#` を用いて網羅的に購読します。受信したすべてのメッセージは、発生時刻とトピック名を付与された状態で、Redisなどの高速な記録層に永続化されます。これにより、どのタイミングで誰がログインし、どのアプリがそれに応答したかという、システム全体の「対話の履歴」をリアルタイムで追跡することが可能になります。


```




## 開発方針
- 各モジュールはdockerイメージになること
- 各モジュールはmqttによる通信によって連携すること
- VPSを想定し、mosquittoを内部のみに開くこと

## 開発概要
- broker
  - mosquittoの設定ファイル等
  - docker-compose.ymlによってmosquittoが組み込まれる。
- monitor
  - redisに流れてきたデータを格納する。
- dummy-app-unit
  - 認証情報が来たらサーバー側の表示を変更する。
  - mqttにリダイレクト先情報を送信する。
